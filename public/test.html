<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        @import "app-css.css";
    </style>
</head>
<script src="/socket.io/socket.io.js"></script>
<body>
    <div class="title-1">Building/Room Crowd Counter</div>
    <div class="link-col">
        <div class="link-item" ><a href="/test.html">Home Page</a></div>
        <div class="link-item" style="padding-left: 20px"><a href="/graph-one.html">See People Count per Hour</a></div>
        <div class="link-item" style="padding-left: 20px"><a href="/graph-two.html">See Peak People Count per Hour</a></div>
    </div>
    <div class="sub-title-1">Number of People Currently in the Building/Room</div>
    <div id="counter" class="counter">17</div>
    <div id="crowd-level" class="crowd-level">Normal</div>
    <div class="box">
        <div id="color-indicator" class="color-indicator"></div>
    </div>
    <div id="last-entered" class="last-entered">Time Updated:</div>
    <div id="timer" class="last-entered">A minute ago</div>
    <div class="link-col">
        <button class="test-button" id="increment" onclick="inc()">Increment Counter</button>
        <button class="test-button" id="decrement" onclick="dec()"">Decrement Counter</button>
    </div>

    <script>
        var socket = io('http://localhost:8484')
        var peopleCount = 0
        var timeLastUpdated = "A minute ago"

        socket.on('connection')
        socket.on('message', (data, relativeTime) =>{
            console.log('received data')
            console.log(timeLastUpdated)

            // console.log(data, relativeTime)
            if (peopleCount != data) {
                document.getElementById('counter').innerHTML = Number(data)
                peopleCount = Number(data)
            }
            if (timeLastUpdated != String(relativeTime)){
                console.log(timeLastUpdated)
                document.getElementById('timer').innerHTML = String(relativeTime)
                timeLastUpdated = String(relativeTime)
            }
            updateCounter()
        })

        function inc() {
            peopleCount += 1
            // console.log(peopleCount)
            socket.emit('entering', peopleCount)
            updateCounter()
        }

        function dec() {
            if (peopleCount > 0) {
                peopleCount -= 1
            }
            // console.log(peopleCount)
            socket.emit('exiting', peopleCount)
            updateCounter()
        }

        function updateCounter() {
            const count = document.getElementById('counter'); // Gets the div with id: counter
            count.innerHTML = 0; // Sets the text to 0
            // const randomValue = Math.floor((Math.random() * 50) + 1); // Generates a random number
            count.innerHTML = peopleCount;
            const timeUpdated = document.getElementById('timer')
            timeUpdated.innerHTML = timeLastUpdated
            const crowd_level = document.getElementById('crowd-level');
            const crowd_indicator = document.getElementById('color-indicator');
            if (peopleCount > 30){
                crowd_level.innerHTML = "Heavily Crowded";
                crowd_indicator.style.backgroundColor = 'red';
            } else if (30 >= peopleCount && peopleCount > 15) {
                crowd_level.innerHTML = "Crowded";
                crowd_indicator.style.backgroundColor = 'yellow';
            } else {
                crowd_level.innerHTML = "Normal";
                crowd_indicator.style.backgroundColor = 'yellowgreen';
            }
        }
        updateCounter()
    </script>
</body>

</html>